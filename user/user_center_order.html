<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>天天生鲜-用户中心</title>
	<link rel="stylesheet" type="text/css" href="../css/reset.css">
	<link rel="stylesheet" type="text/css" href="../css/main.css">
</head>

<body>
	<div class="header_con">
		<div class="header">
			<div class="welcome fl">欢迎来到天天生鲜!</div>
			<div class="fr">
				<div class="login_info fl">
					欢迎您：<em>张 山</em>
				</div>

				<div class="user_link fl">
					<!-- <span>|</span> -->
					<a href="user_center_info.html">用户中心</a>
					<span>|</span>
					<a href="cart.html">我的购物车</a>
					<span>|</span>
					<a href="user_center_order.html">我的订单</a>
				</div>
			</div>
		</div>
	</div>

	<div class="search_bar clearfix">
		<a href="index.html" class="logo fl"><img src="../images/logo.png"></a>
		<div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;用户中心</div>
		<!-- <div class="search_con fr">
			<input type="text" class="input_text fl" name="" placeholder="搜索商品">
			<input type="button" class="input_btn fr" name="" value="搜索">
		</div> -->
	</div>

	<div class="main_con clearfix">
		<div class="left_menu_con clearfix">
			<h3>用户中心</h3>
			<ul>
				<li><a href="user_center_info.html">· 个人信息</a></li>
				<li><a href="user_center_order.html" class="active">· 全部订单</a></li>
				<li><a href="user_center_site.html">· 收货地址</a></li>
				<li><a href="userInfoEdit.html">· 编辑信息</a></li>
			</ul>
		</div>
		<div class="right_content clearfix">
			<h3 class="common_title2">全部订单</h3>
			<div class="list_b_c" id="list_b_c"></div>
			<!-- <ul class="order_list_th w978 clearfix">
				<li class="col01">2016-8-21 17:36:24</li>
				<li class="col02">订单号：56872934</li>
				<li class="col02 stress">未支付</li>
			</ul>

			<table class="order_list_table w980">
				<tbody>
					<tr>
						<td width="55%">
							<ul class="order_goods_list clearfix">
								<li class="col01"><img src="../images/goods02.jpg"></li>
								<li class="col02">嘎啦苹果嘎啦苹果<em>11.80元/500g</em></li>
								<li class="col03">1</li>
								<li class="col04">11.80元</li>
							</ul>
							<ul class="order_goods_list clearfix">
								<li class="col01"><img src="../images/goods02.jpg"></li>
								<li class="col02">嘎啦苹果嘎啦苹果<em>11.80元/500g</em></li>
								<li class="col03">1</li>
								<li class="col04">11.80元</li>
							</ul>
						</td>
						<td width="15%">33.60元</td>
						<td width="15%">待付款</td>
						<td width="15%"><a href="#" class="oper_btn">去付款</a></td>
					</tr>
				</tbody>
			</table>

			<ul class="order_list_th w978 clearfix">
				<li class="col01">2016-8-21 17:36:24</li>
				<li class="col02">订单号：56872934</li>
				<li class="col02 stress">已支付</li>
			</ul>
			<table class="order_list_table w980">
				<tbody>
					<tr>
						<td width="55%">
							<ul class="order_goods_list clearfix">
								<li class="col01"><img src="../images/goods02.jpg"></li>
								<li class="col02">嘎啦苹果嘎啦苹果<em>11.80元/500g</em></li>
								<li class="col03">1</li>
								<li class="col04">11.80元</li>
							</ul>
							<ul class="order_goods_list clearfix">
								<li class="col01"><img src="../images/goods02.jpg"></li>
								<li class="col02">嘎啦苹果嘎啦苹果<em>11.80元/500g</em></li>
								<li class="col03">1</li>
								<li class="col04">11.80元</li>
							</ul>
						</td>
						<td width="15%">33.60元</td>
						<td width="15%">已付款</td>
						<td width="15%"><a href="#" class="oper_btn">查看物流</a></td>
					</tr>
				</tbody>
			</table> -->

			<div class="pagenation">
				<a href="" id="prePage" class="active">上一页</a>
				<a id="pageNow">第x页</a>
				<a id="goodsTotal">共x个订单</a>
				<a id="pageTotal">共x页</a>
				<a href="" id="nextPage" class="active">下一页</a>
			</div>
		</div>
	</div>



	<div class="footer">
		<div class="foot_link">
			<a href="#">关于我们</a>
			<span>|</span>
			<a href="#">联系我们</a>
			<span>|</span>
			<a href="#">招聘人才</a>
			<span>|</span>
			<a href="#">友情链接</a>
		</div>
		<p>CopyRight © 2020 北京鲜生活信息技术有限公司 All Rights Reserved</p>
		<p>电话：010-****888 京ICP备*******8号</p>
	</div>
	<script src="../js/jquery-3.6.0.js"></script>
	<script>
		var urole = 1;
		var pageNum = 1;
		var isLastPage = false;
		//  alert(1);

		// alert(2);
		var username = localStorage.getItem("username");
		var token = localStorage.getItem("token");
		Find();

		$("#hello").html("你好" + username);
		$("#nextPage").click(function (event) {
			//取消默认行为
			event.preventDefault();
			if (isLastPage == true) {
				alert("已经是最后一页了！");
				return;
			} else {
				pageNum = pageNum + 1;

				$("#AddP").remove();
				Find();
			}
		});

		//上一页
		$("#prePage").click(function (event) {
			event.preventDefault();
			if (pageNum == 1) {
				alert("已经是第一页了！");
				return;
			} else {
				pageNum = pageNum - 1;

				$("#AddP").remove();
				Find();
			}
		});
		// alert(3);
		//alert(username);
		function Find() {
			$.ajax({
				headers: {
					token: token,
				},
				async: false,
				url: "http://localhost/VegetableMarket/OrdersPageByUid",
				type: "get",
				data: { username: username, pageNum: pageNum },
				success: function (respTxt) {
					var i = 0;
					//  alert(4);
					$("#pageNow").html("第" + respTxt.data.pageNum + "页");
					$("#pageTotal").html("共" + respTxt.data.pages + "页");
					$("#goodsTotal").html("共" + respTxt.data.total + "个订单");

					isLastPage = respTxt.data.isLastPage;
					last = respTxt.data.pages;
					var orders = respTxt.data.list;
					var div = "<div id=\"AddP\"></div>";
					$("#list_b_c").append(div);
					//alert(5);

					for (var o of orders) {
						i++;
						var li = "<ul class=\"order_list_th w978 clearfix\">" +
							"<li class=\"col01\">" + o.oTime + "</li>" +
							"<li class=\"col02\" style=\"font-size:2px\">订单号：" + o.oid + "</li>" +
							"<li class=\"col02 stress\" style=\"margin-left:110px\">" + o.ostatus + "</li>" +
							"</ul>" +
							"<ul class=\"order_list_th w978 clearfix\">" +
							"<li style=\"margin-left:110px\">名称</li>" +
							"<li  style=\"margin-left:10px\">单价</li>" +
							"<li style=\"margin-left:295px\">数量</li>" +
							"<li style=\"margin-left:70px\">共计</li>" +
							"<li style=\"margin-left:130px\">总计</li>" +
							"<li style=\"margin-left:130px\">订单状态</li>" +
							// "<li style=\"margin-left:110px\">操作</li>" +

							"</ul>" +
							"<table class=\"order_list_table w980\">" +
							"<tbody>" +
							"<tr>" +
							"<td width=\"55%\" id=\"gwc" + i + "\">" +
							// "<ul class=\"order_goods_list clearfix\">" +
							// 	"</ul>" +			
							"</td>" +
							"<td width=\"15%\">" + o.ototalPrice + "元</td>" +
							"<td width=\"15%\">" + o.ostatus + "</td>" +
							// "<td width=\"15%\"><a href=\"#\" class=\"oper_btn\" id=\"payMoney\">查看详情</a></td>" +
							"</tr>" +
							"</tbody>" +
							"</table>";
						//console.log(o.ostatus);
						// if (o.ostatus == "待支付") {
						// 	$("#payMoney").html("待支付");
						// 	//	location.href = "user_center_info.html";
						// } else if (o.ostatus == "待发货") {
						// 	$("#payMoney").html("待发货");
						// 	//	location.href = "user_center_info.html";
						// } else if (o.ostatus == "待收货") {
						// 	$("#payMoney").html("待收货");
						// 	//	location.href = "user_center_info.html";
						// } else {
						// 	$("#payMoney").html("查看详情");
						// 	//		location.href = "cart.html";
						// }

						$("#AddP").append(li);
						var oId = o.oid;

						$.ajax({
							headers: {
								token: token,
							},
							async: false,
							url: "http://localhost/VegetableMarket/OrdersDetails",
							type: "get",
							data: { oId: oId },
							success: function (respTxt) {
								//			alert(2);
								//	alert("resp");
								var OrdersDetailList = respTxt.data;
								//	alert(respTxt.data);	
								//			alert(3);
								for (var od of OrdersDetailList) {

									var gname = 0;
									var gprice = 0;
									var gId = od.gid;
									var es1 = null;
									console.log(gId);
									$.ajax({
										headers: {
											token: token,
										},
										async: false,
										url: "http://localhost/VegetableMarket/goods/gId/" + gId,
										type: "get",
										success: function (respTxt) {
											console.log(respTxt.data.gname);
											gname = respTxt.data.gname;
											gprice = respTxt.data.gprice;
											es1 = respTxt.data.es1;
										}
									});

									var li2 =
										"<ul class=\"order_goods_list clearfix\">" +
										"<li class=\"col01\"><img src=\"http://localhost:8080/images/" + es1 + "\"></li>" +
										"<li class=\"col02\">" + gname + "<em>" + gprice + "元/kg</em></li>" +
										"<li class=\"col03\">" + od.odWeight + "</li>" +
										"<li class=\"col04\">" + od.odPrice.toFixed(2) + "元</li>" +
										"</ul>";
									$("#gwc" + i).append(li2);


								}
							}
						});
					}

				}
			});
		}
	</script>
</body>

</html>