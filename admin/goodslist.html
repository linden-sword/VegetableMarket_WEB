<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="utf-8">
    <link href="../css/admin_main.css" rel="stylesheet">
    <script src="../js/jquery-3.6.0.js"></script>
    <style>
        .b10 {
            width: 10%;
        }

        .b60 {
            width: 25%;
        }
    </style>
</head>

<body>
    <!-- 食品管理 -->
    <div class="AccountManagement_c" id="ColumnManagement_c">
        <h3>食品管理
            <div class="amcl fr">
                <input type="text" placeholder="食品名" class="fl" name="">
                <div class="search fl"><img src="../images/search.png"></div>
            </div>
        </h3>

        <!-- ========================商品分类管理 Zanson Add 10/27 15:47 Started============================== -->
        <span class="goodsClassSelect">按分类管理商品：</span>
        <select id="goodsClass" class="goodsClass">
            <option value="1">1--新鲜水果</option>
            <option value="2">2--海鲜水产</option>
            <option value="3">3--猪肉牛羊</option>
            <option value="4">4--禽类蛋品</option>
            <option value="5">5--新鲜蔬菜</option>
            <option value="6">6--速冻食品</option>
        </select>

        <input type="button" id="b21212" class="b21212" value="Select">

        <style>
            .goodsClassSelect {
                font-size: 16px;
            }

            #goodsClass {
                font-size: 16px;
                border: 1px solid rgb(41, 128, 182);
                color: rgb(41, 128, 182);
                margin-bottom: 6px;
                border-radius: 6px;
            }

            #b21212 {
                font-size: 16px;
                background-color: rgb(245, 95, 44);
                border: 0;
                border-radius: 6px;
                color: white;
                display: inline-block;
                width: 100px;
                height: 25px;
                margin-bottom: 5px;
            }
        </style>

        <!-- ========================商品分类管理 Zanson Add 10/27 15:47 Ended============================== -->


        <div class="AM_ct text_center">
            <div class="AM_ct_in">
                <a href="goodsadd.html">
                    <div class="add_btn df_btn fl" id="add_column_btn">添加</div>
                </a>
            </div>
        </div>

        <div class="list">
            <ul class="list_h">
                <li class="b10"><label><input type="checkbox" name="newsId"><span>编号</span></label></li>
                <li class="b20"><label>食品名称</label></li>
                <li class="b20"><label>单价</label></li>
                <li class="b20"><label>促销价</label></li>
                <li class="b20"><label>类型</label></li>
                <li class="b60"><label>操作</label></li>
            </ul>
            <div class="list_b_c">
                
            </div>

            <div class="pull_page">

            </div>
        </div>
    </div>


    <script>
        var token = localStorage.getItem("token");

        var pageNumH = 1;
        var pageNumI = 1;
        var isLastPage = false;

        allGoods(1);

        //全部商品的上下页
        //下一页
        // $("#nextPage1").click(function () {
        $("body").on("click", "#nextPage1", function () {
            if (isLastPage == true) {
                alert("已经是最后一页了！");
                return;
            } else {
                pageNumH = pageNumH + 1;
                allGoods(pageNumH);
            }
        });
        //上一页
        // $("#prePage1").click(function () {
        $("body").on("click", "#prePage1", function () {
            if (pageNumH == 1) {
                alert("已经是第一页了！");
                return;
            } else {
                pageNumH = pageNumH - 1;
                allGoods(pageNumH);
            }
        });

        var goodsClass = 0;
        //按分类筛选
        $("#b21212").click(function () {
            goodsClass = $('#goodsClass option:selected').val();
            // alert(goodsClass);
            goods(goodsClass, 1);



        })

        //分类商品的上下页
        //下一页
        // $("#nextPage2").click(function () {
        $("body").on("click", "#nextPage2", function () {
            if (isLastPage == true) {
                alert("已经是最后一页了！");
                return;
            } else {
                pageNumI = pageNumI + 1;
                // alert("goodsClass"+goodsClass)
                goods(goodsClass, pageNumI);
            }
        });
        //上一页
        // $("#prePage2").click(function () {
        $("body").on("click", "#prePage2", function () {
            if (pageNumI == 1) {
                alert("已经是第一页了！");
                return;
            } else {
                pageNumI = pageNumI - 1;
                alert("goodsClass"+goodsClass)
                goods(goodsClass, pageNumI);
            }
        });


        //全部商品分页查询
        function allGoods(pageNum) {
            $.ajax({
                headers: {
                    token: token
                },
                url: "http://localhost/VegetableMarket/goods/allGoods",
                type: "get",
                data: {
                    pageNum: pageNum,
                },
                async: false,
                success: function (respText) {
                    // alert(respText.code+" : "+respText.message+" : "+respText.data)
                    $(".pull_page").empty();
                    var preNext = "<div class=\"fl pull_page_up\" id=\"prePage1\">上一页</div>" +
                        "<ul>" +
                        "<li>第" + respText.data.pageNum + "页</li>" +
                        "<li>共" + respText.data.total + "个商品</li>" +
                        "<li>共" + respText.data.pages + "页</li>" +
                        "</ul>" +
                        "<div class=\"fl pull_page_down\" id=\"nextPage1\">下一页</div>";
                    $(".pull_page").append(preNext);

                    isLastPage = respText.data.isLastPage;
                    // last = respText.data.pages;

                    $(".list_b").remove();
                    var goodsList = respText.data.list;
                    for (var goods of goodsList) {
                        var goods = "<ul class=\"list_b\">" +
                            "<li class=\"b10\"><label><input type=\"checkbox\" name=\"\"><span>" + goods.gid + "</span></label></li>" +
                            "<li class=\"b20\"><label>" + goods.gname + "</label></li>" +
                            "<li class=\"b20\"><label>￥" + goods.gprice + "</label></li>" +
                            "<li class=\"b20\"><label>￥" + goods.gprice + "</label></li>" +
                            "<li class=\"b20\"><label>" + goods.cid + "</label></li>" +
                            "<li class=\"b60\">" +
                            "<a href=\"goodsedit.html\">" +
                            "<div class=\"edit_btn df_btn fl text_center\">编辑</div>" +
                            "</a>" +
                            "<a href=\"goodsdetail.html\">" +
                            "<div class=\"edit_btn df_btn fl text_center\">详情</div>" +
                            "</a>" +
                            "<a href=\"\">" +
                            "<div class=\"delete_btn df_btn fl text_center\">删除</div>" +
                            "</a>" +
                            "</li>" +
                            "</ul>";
                        $(".list_b_c").append(goods);
                    }

                }
            })
        }

        //按分类分页查询
        function goods(cId, pageNum) {
            $.ajax({
                headers: {
                    token: token
                },
                url: "http://localhost/VegetableMarket/goods/cId/" + cId,
                type: "get",
                data: {
                    pageNum: pageNum,
                },
                async: false,
                success: function (respText) {
                    // alert(respText.code+" : "+respText.message+" : "+respText.data)
                    $(".pull_page").empty();
                    $(".list_b_c").empty();
                    if(respText.data == null){
                        $(".list_b").remove();
                        $(".list_b_c").append("<h3 id='noneGoods'>【该分类没有商品】</h3>");
                    }
                    var preNext2 = "<div class=\"fl pull_page_up\" id=\"prePage2\">上一页</div>" +
                        "<ul>" +
                        "<li>第" + respText.data.pageNum + "页</li>" +
                        "<li>共" + respText.data.total + "个商品</li>" +
                        "<li>共" + respText.data.pages + "页</li>" +
                        "</ul>" +
                        "<div class=\"fl pull_page_down\" id=\"nextPage2\">下一页</div>";
                    $(".pull_page").append(preNext2);

                    isLastPage = respText.data.isLastPage;
                    // last = respText.data.pages;

                    $(".list_b").remove();
                    var goodsList = respText.data.list;
                    for (var goods of goodsList) {
                        var goods = "<ul class=\"list_b\">" +
                            "<li class=\"b10\"><label><input type=\"checkbox\" name=\"\"><span>" + goods.gid + "</span></label></li>" +
                            "<li class=\"b20\"><label>" + goods.gname + "</label></li>" +
                            "<li class=\"b20\"><label>￥" + goods.gprice + "</label></li>" +
                            "<li class=\"b20\"><label>￥" + goods.gprice + "</label></li>" +
                            "<li class=\"b20\"><label>" + goods.cid + "</label></li>" +
                            "<li class=\"b60\">" +
                            "<a href=\"goodsedit.html\">" +
                            "<div class=\"edit_btn df_btn fl text_center\">编辑</div>" +
                            "</a>" +
                            "<a href=\"goodsdetail.html\">" +
                            "<div class=\"edit_btn df_btn fl text_center\">详情</div>" +
                            "</a>" +
                            "<a href=\"\">" +
                            "<div class=\"delete_btn df_btn fl text_center\">删除</div>" +
                            "</a>" +
                            "</li>" +
                            "</ul>";
                        $(".list_b_c").append(goods);
                    }
                }
            })
        }
    </script>

</body>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/main.js"></script>

</html>